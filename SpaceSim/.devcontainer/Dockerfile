# Base image avec Node.js 20 et TypeScript pr√©install√©
FROM mcr.microsoft.com/devcontainers/typescript-node:20-bullseye

# Configure retry pour apt
RUN echo 'Acquire::Retries "3";' > /etc/apt/apt.conf.d/80-retries

# Mise √† jour et installation des d√©pendances syst√®me
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    git \
    curl \
    ca-certificates \
    pkg-config \
    build-essential \
    python3 \
    libcairo2-dev \
    libpango1.0-dev \
    libjpeg-dev \
    libgif-dev \
    librsvg2-dev \
    libgl1-mesa-dev \
    libxi-dev \
    libnss3 \
    libatk-bridge2.0-0 \
    libxcomposite1 \
    libxrandr2 \
    libasound2 \
    libxdamage1 \
    libxkbcommon0 \
    libgbm-dev \
    && rm -rf /var/lib/apt/lists/*

# ------------------------------------------------------------
# üß∞ Installation des outils Node/JS utiles
# ------------------------------------------------------------
RUN npm install -g \
    pnpm \
    yarn \
    typescript \
    ts-node \
    nodemon \
    @nestjs/cli \
    eslint \
    prettier \
    serve \
    concurrently

# ------------------------------------------------------------
# üß© Installation des d√©pendances globales de ton projet
# ------------------------------------------------------------
# (tu pourras les ajuster selon ton package.json)
RUN npm install -g \
    @hashgraph/sdk \
    phaser \
    canvas \
    jsdom \
    @napi-rs/canvas \
    cross-env

# ------------------------------------------------------------
# üìÅ Configuration du r√©pertoire de travail
# ------------------------------------------------------------
WORKDIR /workspace

# Copie des fichiers du projet (facultatif ici si tu montes un volume devcontainer)
# COPY . .

# ------------------------------------------------------------
# üîß Variables d‚Äôenvironnement utiles
# ------------------------------------------------------------
ENV NODE_ENV=development
ENV TZ=Europe/Paris
ENV DEBIAN_FRONTEND=noninteractive
ENV LANG=C.UTF-8

# ------------------------------------------------------------
# üöÄ Commande par d√©faut
# ------------------------------------------------------------
CMD ["bash"]
